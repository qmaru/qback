// protoc --proto_path .\grpc\pb\ --go_out=. --go-grpc_out=. .\grpc\pb\transfer.proto
syntax = "proto3";

package pb;

option go_package = "grpc/libs/;libs";

service FileTransferService {
  rpc ServerCheck(Ping) returns (Pong) {};
  rpc ListFiles(ListFilesRequest) returns (ListFilesResponse) {};
  rpc UploadFile(stream UploadRequest) returns (stream UploadResponse) {};
  rpc DownloadFile(DownloadRequest) returns (stream DownloadResponse) {};
}

message Ping { bool status = 1; }

message Pong { bool status = 1; }

message FileMetadata {
  string tag = 1;
  string name = 2;
  int64 size = 3;
  int64 chunks = 4;
  int64 chunksize = 5;
  string hash = 6;
}

message ChunkData {
  bytes data = 1;
  int64 chunk = 2;
}

message UploadRequest {
  oneof payload {
    FileMetadata metadata = 1;
    ChunkData chunk = 2;
  }
}

message UploadResponse {
  oneof payload {
    MetaAck meta_ack = 1;
    ChunkAck chunk_ack = 2;
    TransferResult result = 3;
  }
}
message MetaAck {
  bool allow_upload = 1;
  string message = 2;
}

message ChunkAck {
  int64 chunk = 1;
  bool received = 2;
}

message TransferResult {
  bool status = 1;
  string message = 2;
}

message DownloadRequest {
  string tag = 1;
  string name = 2;
  int64 chunksize = 3;
}

message DownloadResponse {
  oneof payload {
    FileMetadata metadata = 1;
    ChunkData chunk = 2;
    TransferResult result = 3;
  }
}

message ListFileItem {
  string name = 1;
  int64 size = 2;
  string hash = 3;
  int64 modified_time = 4;
}

message ListFilesRequest { string tag = 1; }

message ListFilesResponse {
  bool status = 1;
  string message = 2;
  repeated ListFileItem files = 3;
}
